<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>首页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <link rel="stylesheet" href="../static/css/global.css">
</head>
<body>

<div class="fly-header layui-bg-black">
    <div class="layui-container">
        <a class="fly-logo" href="/">
            <img src="../static/images/logo.png" alt="layui">
        </a>
        <ul class="layui-nav fly-nav layui-hide-xs">
            <li class="layui-nav-item layui-this">
                <a href="/dynamic/index?firstTitle=1&secondTitle=3">
                    <i class="iconfont icon-jiaoliu"></i>心情
                </a>
            </li>
            <li class="layui-nav-item">
                <a href="/dynamic/index?firstTitle=2&secondTitle=1">
                    <i class="iconfont icon-iconmingxinganli"></i>话题
                </a>
            </li>
        </ul>

        <ul id="unLogin" class="layui-nav fly-nav-user">

            <!-- 未登入的状态 -->
            <li class="layui-nav-item">
                <a class="iconfont icon-touxiang layui-hide-xs" href="/customer/loginView"></a>
            </li>
            <li class="layui-nav-item">
                <a href="/customer/loginView">登入</a>
            </li>
            <li class="layui-nav-item">
                <a href="/customer/registerView">注册</a>
            </li>
        </ul>

        <!-- 登入后的状态 -->
        <ul id="inLogin" class="layui-nav fly-nav-user layui-hide">
            <li class="layui-nav-item">
                <a class="fly-nav-avatar" href="javascript:;">
                    <input id="customerId" type="hidden" value=""/>
                    <cite id="nickName" class="layui-hide-xs">贤心</cite>
                    <img id="myHead"
                         src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg">
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="/customer/setView"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
                    <dd><a href="/customer/messageView"><i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a>
                    </dd>
                    <dd><a href="/customer/home"><i class="layui-icon" style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a>
                    </dd>
                    <hr style="margin: 5px 0;">
                    <dd><a href="/customer/logout" style="text-align: center;">退出</a></dd>
                </dl>
            </li>
        </ul>


    </div>
</div>

<div class="fly-panel fly-column">
    <div class="layui-container">
        <ul class="layui-clear">
            <li class="layui-hide-xs layui-this"><a href="/">推荐</a></li>
            <li><a href="/dynamic/index?firstTitle=1&secondTitle=1" class="loginCheck">好友圈</a></li>
            <li><a href="/dynamic/index?firstTitle=1&secondTitle=2" class="loginCheck">身边</a></li>
            <li><a href="/dynamic/index?firstTitle=1&secondTitle=3">校园</a></li>
            <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block"><span class="fly-mid"></span></li>

            <!-- 用户登入后显示 -->
            <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block">
                <a href="/customer/indexView" class="loginCheck">我的动态</a>
            </li>
            <li class="layui-hide-xs layui-hide-sm layui-show-md-inline-block">
                <a href="/customer/indexView#collection" class="loginCheck">我的收藏</a>
            </li>
        </ul>

        <div class="fly-column-right layui-hide-xs">
            <span class="fly-search"><i class="layui-icon"></i></span>
            <a href="/dynamic/addView" class="layui-btn">搞事情</a>
        </div>
        <div class="layui-hide-sm layui-show-xs-block"
             style="margin-top: -10px; padding-bottom: 10px; text-align: center;">
            <a href="/dynamic/addView" class="layui-btn">搞事情</a>
        </div>
    </div>
</div>

<div class="layui-container">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md8">
            <div class="fly-panel">

                <div class="layui-carousel" id="test1">
                    <div carousel-item>
                        <a href="/dynamic/index?firstTitle=1&secondTitle=3">
                            <img src="../static/images/other/catoo.jpg" width="100%" height="100%">
                        </a>
                        <a href="/dynamic/index?firstTitle=1&secondTitle=3">
                            <img src="../static/images/other/leave.jpg" width="100%" height="100%">
                        </a>
                        <a href="/dynamic/index?firstTitle=1&secondTitle=3" width="100%" height="100%">
                            <img src="../static/images/other/pen.jpg">
                        </a>
                        <a href="/dynamic/index?firstTitle=1&secondTitle=3">
                            <img src="../static/images/other/room.jpg" width="100%" height="100%">

                        </a>
                        <a href="/dynamic/index?firstTitle=1&secondTitle=3">
                            <img src="../static/images/other/talk.jpg" width="100%" height="100%">
                        </a>
                    </div>
                </div>
            </div>


            <div class="fly-panel" style="margin-bottom: 0;">

                <div class="fly-panel-title fly-filter">
                    <span class="fly-filter-right layui-hide-xs">
                        <a href="javascript:void(0);" class="layui-this sortStyle" data-value="1">按最新</a>
                        <span class="fly-mid"></span>
                        <a href="javascript:void(0);" class="sortStyle" data-value="2">按热议</a>
                    </span>
                </div>

                <ul class="fly-list" id="tableList">
                    <!--                    <li>
                                            <a href="user/home.html" class="fly-avatar">
                                                <img src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg"
                                                     alt="贤心">
                                            </a>
                                            <h2>
                                                <a class="layui-badge">分享</a>
                                                <a href="jie/detail.html">基于 layui 的极简社区页面模版</a>
                                            </h2>
                                            <div class="fly-list-info">
                                                <a href="user/home.html" link>
                                                    <cite>贤心</cite>
                                                    &lt;!&ndash;
                                                    <i class="iconfont icon-renzheng" title="认证信息：XXX"></i>
                                                    <i class="layui-badge fly-badge-vip">VIP3</i>
                                                    &ndash;&gt;
                                                </a>
                                                <span>刚刚</span>

                                                <span class="fly-list-kiss layui-hide-xs" title="悬赏飞吻"><i class="iconfont icon-kiss"></i> 60</span>
                                                &lt;!&ndash;<span class="layui-badge fly-badge-accept layui-hide-xs">已结</span>&ndash;&gt;
                                                <span class="fly-list-nums">
                                                    <i class="iconfont icon-pinglun1" title="回答"></i> 66
                                                </span>
                                            </div>
                                            <div class="fly-list-badge">
                                                &lt;!&ndash;<span class="layui-badge layui-bg-red">精帖</span>&ndash;&gt;
                                            </div>
                                        </li>-->
                    <div class="fly-none">没有相关数据</div>
                </ul>
                <script id="table-template" type="text/x-handlebars-template">
                    {{#each this}}
                    <li>
                        <a href="/customer/home?customerId={{customerId}}" class="fly-avatar">
                            <img src="{{headPicture}}"
                                 alt="{{nickName}}">
                        </a>
                        <h2>
                            <a class="layui-badge">动态</a>
                            <a href="/dynamic/detailView?dynamicId={{dynamicId}}">{{title}}</a>
                        </h2>
                        <div class="fly-list-info">
                            <a href="/customer/indexView?customerId={{customerId}}" link>
                                <cite>{{nickName}}</cite>
                            </a>
                            <span>{{createDate}}</span>

                            <span class="fly-list-kiss layui-hide-xs" title="赞">
                                <i class="iconfont icon-zan"></i> {{praise}}
                            </span>
                            <span class="fly-list-nums">
                                <i class="iconfont icon-pinglun1" title="评论"></i> {{commentsNumber}}
                            </span>
                        </div>
                    </li>
                    {{/each}}
                </script>
                <div style="text-align: center">
                    <div class="laypage-main">
                        <a href="/dynamic/index?firstTitle=1&secondTitle=3" class="laypage-next">发现更多</a>
                    </div>
                </div>

            </div>
        </div>


        <div class="layui-col-md4">

            <div class="fly-panel fly-signin">
                <div class="fly-panel-title">
                    签到
                    <i class="fly-mid"></i>
                    <a href="javascript:;" class="fly-link" id="LAY_signinHelp">说明</a>
                    <i class="fly-mid"></i>
                    <span id="continueSignText" class="fly-signin-days layui-hide">
                        已连续签到
                        <cite id="continueSignCount">16</cite>
                        天
                    </span>
                </div>
                <div class="fly-panel-main fly-signin-main">
                    <div id="unSignIn" class="layui-hide">
                        <button class="layui-btn layui-btn-danger" id="LAY_signin">今日签到</button>
                        <span>可获得<cite id="unSignInValue">5</cite>活跃值</span>
                    </div>
                    <!-- 已签到状态 -->
                    <div id="inSignIn" class="layui-hide">
                        <button class="layui-btn layui-btn-disabled">今日已签到</button>
                        <span>获得了<cite id="inSignInValue">20</cite>活跃值</span>
                    </div>
                </div>
            </div>

            <div class="fly-panel">
                <h3 class="fly-panel-title">温馨通道</h3>
                <ul class="fly-panel-main fly-list-static">
                    <li>
                        <a href="https://github.com/zhanxupeng/SpringbootS" target="_blank">项目的GitHub，欢迎Star</a>
                    </li>
                    <li>
                        <a href="https://blog.csdn.net/tomorrow_fine" target="_blank">
                            作者的CSDN博客
                        </a>
                    </li>
                    <li>
                        <a href="http://www.layui.com/" target="_blank">layui（经典模块化前端框架） 官网</a>
                    </li>
                    <li>
                        <a href="https://projects.spring.io/spring-boot/" target="_blank">
                            spring boot 官网
                        </a>
                    </li>
                    <li>
                        <a href="http://www.mybatis.org/mybatis-3/" target="_blank">mybatis3入门</a>
                    </li>
                </ul>
            </div>

            <div class="fly-panel fly-rank fly-rank-reply layui-hide" id="recommendRank">
                <h3 class="fly-panel-title">亲密度榜</h3>
                <dl id="recommendTable">
                    <!--<i class="layui-icon fly-loading">&#xe63d;</i>-->
                    <dd style="float:left">
                        <a href="user/home.html">
                            <img src="../static/images/avatar/2.jpg"><cite>替身天使</cite><i>100亲密度</i>
                        </a>
                    </dd>
                    <dd style="float:left">
                        <a href="user/home.html">
                            <img src="../static/images/avatar/8.jpg"><cite>小鹏</cite><i>52亲密度</i>
                        </a>
                    </dd>
                    <script id="recommend-template" type="text/x-handlebars-template">
                        {{#each this}}
                        <dd style="float:left">
                            <a href="/customer/home?customerId={{customerId}}">
                                <img src="{{headPicture}}" alt="{{nickName}}">
                                <cite>{{nickName}}</cite><i>{{familiarity}}亲密度</i>
                            </a>
                        </dd>
                        {{/each}}
                    </script>
                </dl>
            </div>

            <div class="fly-panel">
                <div class="fly-panel-title">
                    广告区域
                </div>
                <div class="fly-panel-main">
                    <a href="https://www.imooc.com/" target="_blank" class="fly-zanzhu"
                       time-limit="2017.09.25-2099.01.01" style="background-color: #5FB878;">IMOOC-程序员的梦工场</a>
                </div>
            </div>

            <div class="fly-panel fly-link">
                <h3 class="fly-panel-title">友情链接</h3>
                <dl class="fly-panel-main">
                    <dd><a href="http://www.layui.com/" target="_blank">layui</a>
                    <dd>
                    <dd><a href="http://layim.layui.com/" target="_blank">WebIM</a>
                    <dd>
                    <dd><a href="http://layer.layui.com/" target="_blank">layer</a>
                    <dd>
                    <dd><a href="http://www.layui.com/laydate/" target="_blank">layDate</a>
                    <dd>
                </dl>
            </div>

        </div>
    </div>
</div>

<div class="fly-footer">

</div>
<script src="../static/jquery/jquery-3.2.1.js"></script>
<script src="../static/handlebars/handlebars-1.0.0.beta.6.js"></script>
<script src="../static/layui/layui.js"></script>
<script>
    layui.cache.page = '';
    layui.cache.user = {
        username: '游客'
        , uid: -1
        , avatar: '../static/images/avatar/00.jpg'
        , experience: 83
        , sex: '男'
    };
    layui.config({
        version: "3.0.0"
        , base: '../static/mods/' //这里实际使用时，建议改成绝对路径
    }).extend({
        fly: 'index'
    }).use('fly');

    layui.use(['layer', 'carousel'], function () {
        var layer = layui.layer;
        $(document).ready(function () {
            var $unLogin = $("#unLogin");
            var $inLogin = $("#inLogin");
            var $customerId = $("#customerId");
            $.ajax({
                url: '/customer/information',
                type: 'get',
                dataType: 'json',
                success: function (data) {
                    if (data.id != null && data.id != '') {
                        //说明用户已经登录，改为登录状态
                        $inLogin.removeClass("layui-hide");
                        $unLogin.addClass("layui-hide");
                        $("#nickName").text(data.nickName);
                        $("#myHead").attr("src", data.headPicture);
                        $customerId.val(data.id);

                        //亲密度榜单
                        familiarityRank();
                    }
                },
                error: function () {

                }
            });

            initSignIn();

            //签到模块
            var $signIn = $("#LAY_signin");
            $signIn.click(function () {
                if ($customerId.val() == null || $customerId.val() == '') {
                    layer.msg('必须登录才可以签到哦', {icon: 5});
                } else {
                    $.ajax({
                        url: '/customer/sign',
                        type: 'get',
                        dataType: 'json',
                        success: function (data) {
                            //签到是否成功 signFlag ,提示信息 signMessage
                            if (data.signFlag) {
                                layer.alert(data.signMessage, {icon: 6});
                                initSignIn();
                            } else {
                                layer.msg(data.signMessage, {icon: 5});
                            }
                        },
                        error: function () {

                        }
                    });
                }
            });

            $(".loginCheck").click(function () {
                if ($customerId.val() == null || $customerId.val() == '') {
                    layer.msg('必须登录才可以查看哦', {icon: 5});
                    return false;
                }
                return true;
            });

            $(".sortStyle").click(function () {
                $(".sortStyle").removeClass("layui-this");
                $(this).addClass("layui-this");
                recommend();
            });

            //获取推荐数据
            recommend();
        });
        //亲密度榜
        function familiarityRank() {
            $.ajax({
                url: '/friend/familiarityRank',
                contentType: "application/json; charset=utf-8",
                type: 'get',
                dataType: 'json',
                success: function (data) {
                    var dataList = data.data;
                    if (dataList.length !== 0) {
                        var myTemplate = Handlebars.compile($("#recommend-template").html());
                        $("#recommendTable").html(myTemplate(dataList));
                        $("#recommendRank").removeClass("layui-hide");
                    }
                }
            });
        }

        //获取推荐数据
        function recommend() {
            var value = $(".sortStyle").filter(".layui-this").attr("data-value");
            $.ajax({
                url: '/dynamic/recommend',
                type: 'get',
                dataType: 'json',
                data: {
                    recommendType: value
                },
                success: function (data) {
                    var dataList = data.data;
                    if (dataList.length !== 0) {
                        //注册一个Handlebars模版，通过id找到某一个模版，获取模版的html框架
                        var myTemplate = Handlebars.compile($("#table-template").html());

                        //将json对象用刚刚注册的Handlebars模版封装，得到最终的html，插入到基础table中。
                        $('#tableList').html(myTemplate(dataList));
                    }
                }
            });
        }

        //初始化签到模块
        function initSignIn() {
            $.ajax({
                url: '/customer/signIn',
                type: 'get',
                dataType: 'json',
                success: function (data) {
                    //是否登录 loginFlag,今日是否签到 signInFlag ,是否显示连续签到天数 showSignInCountFlag
                    //连续签到天数 continueActiveCount,签到获得活跃值 activeValue
                    var $continueSignText = $("#continueSignText");
                    var $continueSignCount = $("#continueSignCount");
                    var $unSignIn = $("#unSignIn");
                    var $unSignInValue = $("#unSignInValue");
                    var $inSignIn = $("#inSignIn");
                    var $inSignInValue = $("#inSignInValue");
                    if (data.loginFlag) {//已经登录
                        if (data.signInFlag) {//今日已经签到
                            //连续签到显示
                            $continueSignText.removeClass("layui-hide");
                            $continueSignCount.text(data.continueActiveCount);
                            //未签到隐藏
                            $unSignIn.removeClass("layui-hide");
                            $unSignIn.addClass("layui-hide");
                            //已经签到显示
                            $inSignIn.removeClass("layui-hide");
                            $inSignInValue.text(data.activeValue);
                        } else {//今日还未签到
                            if (data.showSignInCountFlag) {//连续签到
                                //连续签到显示
                                $continueSignText.removeClass("layui-hide");
                                $continueSignCount.text(data.continueActiveCount);
                                //未签到显示
                                $unSignIn.removeClass("layui-hide");
                                $unSignInValue.text(data.activeValue);
                                //已经签到隐藏
                                $inSignIn.removeClass("layui-hide");
                                $inSignIn.addClass("layui-hide");
                            } else {//已经断签
                                //连续签到隐藏
                                $continueSignText.removeClass("layui-hide");
                                $continueSignText.addClass("layui-hide");
                                //未签到显示
                                $unSignIn.removeClass("layui-hide");
                                $unSignInValue.text(data.activeValue);
                                //已经签到隐藏
                                $inSignIn.removeClass("layui-hide");
                                $inSignIn.addClass("layui-hide");
                            }
                        }
                    } else {//未登录
                        //连续签到隐藏
                        $continueSignText.removeClass("layui-hide");
                        $continueSignText.addClass("layui-hide");
                        //未签到显示
                        $unSignIn.removeClass("layui-hide");
                        //已经签到隐藏
                        $inSignIn.removeClass("layui-hide");
                        $inSignIn.addClass("layui-hide");
                    }
                },
                error: function () {

                }
            });
        }


        var carousel = layui.carousel;
        //建造实例
        carousel.render({
            elem: '#test1'
            , width: '100%' //设置容器宽度
            , arrow: 'always' //始终显示箭头
            , height: '350px'
            , anim: 'fade'
            //,anim: 'updown' //切换动画方式
        });

    });
</script>

</body>
</html>